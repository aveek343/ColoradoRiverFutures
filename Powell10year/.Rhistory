sPowellHistoricalFile <- 'PowellDataUSBRJan2019.csv'
# File name to read in Mead end of month reservoir level in feet - cross tabulated by year (1st column) and month (subsequent columns)
#    LAKE MEAD AT HOOVER DAM, END OF MONTH ELEVATION (FEET), Lower COlorado River Operations, U.S. Buruea of Reclamation
#    https://www.usbr.gov/lc/region/g4000/hourly/mead-elv.html
# Read in the historical Powell data
dfPowellHistorical <- read.csv(file=sPowellHistoricalFile,
header=TRUE,
stringsAsFactors=FALSE,
sep=",")
#Interpolate Powell storage from level to check
dtStart <- as.Date("1963-12-22")
dfPowellHist <- dfPowellHistorical[15:692,] #%>% filter(dfPowellHistorical$Date >= dtStart) # I don't like this hard coding but don't know a way around
#Convert date text to date value
dfPowellHist$DateAsValueError <- as.Date(dfPowellHist$Date,"%d-%b-%y")
#Apparently R breaks the century at an odd place
#Coerce the years after 2030 (really 1930) to be in prior century (as.Date conversion error)
dfPowellHist$Year <- as.numeric(format(dfPowellHist$DateAsValueError,"%Y"))
dfPowellHist$DateAsValue <- dfPowellHist$DateAsValueError
dfPowellHist$DateAsValue[dfPowellHist$Year > 2030] <- dfPowellHist$DateAsValue[dfPowellHist$Year > 2030] %m-% months(12*100)
# Convert CFS to Acre-feet per month
nCFStoAFMon <- 60.37
#Annual total release
dfPowellHist$OneYearRelease <- rollapply(dfPowellHist$Total.Release..cfs.*nCFStoAFMon/1e6, 12,sum, fill=NA, align="right")
#10-year total release
dfPowellHist$TenYearRelease <- rollapply(dfPowellHist$Total.Release..cfs.*nCFStoAFMon/1e6, 12*10,sum, fill=NA, align="right")
#75 MAF ten-year target
dfPowellHist$TenYearTarget <- 75
# Difference between 10-year and target
dfPowellHist$Diff <- dfPowellHist$TenYearRelease - dfPowellHist$TenYearTarget
#Filter to get yearly amounts. Filter on October
dfPowellHist$Month <- month(dfPowellHist$DateAsValue)
dfPowellHist$Year <- year(dfPowellHist$DateAsValue)
dfPowellHistAnnual <- dfPowellHist %>% filter(Month==10)
# Add text for the decade
dfPowellHistAnnual$Decade <- paste0(dfPowellHistAnnual$Year - 10 + 1," to ",dfPowellHistAnnual$Year)
dfPowellHistAnnual$TenYearReleaseRnd <- round(dfPowellHistAnnual$TenYearRelease, digits=1)
# Select into two columns and reverse sort
dfPowellByDecade <- dfPowellHistAnnual %>% arrange(Year, decreasing = TRUE) %>% select(Decade, TenYearReleaseRnd)
#Export to CSV
write.csv(dfPowellByDecade,"DecadePowellRelease.csv" )
#### Powell Release over time - monthly
ggplot() +
#Powell release - monthly
geom_line(data=dfPowellHist,aes(x=DateAsValue,y=Total.Release..cfs.*nCFStoAFMon/1e6, color="Monthly"), size=2) +
# Powell release-  annual
geom_line(data=dfPowellHist,aes(x=DateAsValue,y=OneYearRelease, color="1-year"), size=2) +
#  10-year sum
geom_line(data=dfPowellHist,aes(x=DateAsValue,y=TenYearRelease, color="10-year"), size=2) +
geom_line(data=dfPowellHist,aes(x=DateAsValue,y=TenYearTarget, color="Target"), size=2) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Powel Release (million acre-feet)") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18))
#theme(text = element_text(size=20), legend.text=element_text(size=16)
#### Powell Release over time - annual
ggplot() +
#Powell release - monthly
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=Total.Release..cfs.*nCFStoAFMon/1e6, color="Monthly"), size=2) +
# Powell release-  annual
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=OneYearRelease, color="1-year"), size=2) +
#  10-year sum
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearRelease, color="10-year"), size=2) +
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearTarget, color="Target"), size=2) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Powel Release (million acre-feet)") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18))
#theme(text = element_text(size=20), legend.text=element_text(size=16)
sPowellHistoricalFile <- 'PowellDataUSBRJan2019.csv'
# File name to read in Mead end of month reservoir level in feet - cross tabulated by year (1st column) and month (subsequent columns)
#    LAKE MEAD AT HOOVER DAM, END OF MONTH ELEVATION (FEET), Lower COlorado River Operations, U.S. Buruea of Reclamation
#    https://www.usbr.gov/lc/region/g4000/hourly/mead-elv.html
# Read in the historical Powell data
dfPowellHistorical <- read.csv(file=sPowellHistoricalFile,
header=TRUE,
stringsAsFactors=FALSE,
sep=",")
#Interpolate Powell storage from level to check
dtStart <- as.Date("1963-12-22")
dfPowellHist <- dfPowellHistorical[15:692,] #%>% filter(dfPowellHistorical$Date >= dtStart) # I don't like this hard coding but don't know a way around
#Convert date text to date value
dfPowellHist$DateAsValueError <- as.Date(dfPowellHist$Date,"%d-%b-%y")
#Apparently R breaks the century at an odd place
#Coerce the years after 2030 (really 1930) to be in prior century (as.Date conversion error)
dfPowellHist$Year <- as.numeric(format(dfPowellHist$DateAsValueError,"%Y"))
dfPowellHist$DateAsValue <- dfPowellHist$DateAsValueError
dfPowellHist$DateAsValue[dfPowellHist$Year > 2030] <- dfPowellHist$DateAsValue[dfPowellHist$Year > 2030] %m-% months(12*100)
# Convert CFS to Acre-feet per month
nCFStoAFMon <- 60.37
#Annual total release
dfPowellHist$OneYearRelease <- rollapply(dfPowellHist$Total.Release..cfs.*nCFStoAFMon/1e6, 12,sum, fill=NA, align="right")
#10-year total release
dfPowellHist$TenYearRelease <- rollapply(dfPowellHist$Total.Release..cfs.*nCFStoAFMon/1e6, 12*10,sum, fill=NA, align="right")
#75 and 82.5 MAF ten-year targets
dfPowellHist$TenYearTarget <- 75
dfPowellHist$TenYearTarget82 <- 75 + 7.5
# Difference between 10-year and target
dfPowellHist$Diff <- dfPowellHist$TenYearRelease - dfPowellHist$TenYearTarget82
#Filter to get yearly amounts. Filter on October
dfPowellHist$Month <- month(dfPowellHist$DateAsValue)
dfPowellHist$Year <- year(dfPowellHist$DateAsValue)
dfPowellHistAnnual <- dfPowellHist %>% filter(Month==10)
# Add text for the decade
dfPowellHistAnnual$Decade <- paste0(dfPowellHistAnnual$Year - 10 + 1," to ",dfPowellHistAnnual$Year)
dfPowellHistAnnual$TenYearReleaseRnd <- round(dfPowellHistAnnual$TenYearRelease, digits=1)
dfPowellHistAnnual$TenYearDiffRnd <- round(dfPowellHistAnnual$Diff, digits=1)
# Select into two columns and reverse sort
dfPowellByDecade <- dfPowellHistAnnual %>% arrange(Year, decreasing = TRUE) %>% select(Decade, TenYearReleaseRnd,TenYearDiffRnd)
#Export to CSV
write.csv(dfPowellByDecade,"DecadePowellRelease.csv" )
#### Powell Release over time - monthly
ggplot() +
#Powell release - monthly
geom_line(data=dfPowellHist,aes(x=DateAsValue,y=Total.Release..cfs.*nCFStoAFMon/1e6, color="Monthly"), size=2) +
# Powell release-  annual
geom_line(data=dfPowellHist,aes(x=DateAsValue,y=OneYearRelease, color="1-year"), size=2) +
#  10-year sum
geom_line(data=dfPowellHist,aes(x=DateAsValue,y=TenYearRelease, color="10-year"), size=2) +
geom_line(data=dfPowellHist,aes(x=DateAsValue,y=TenYearTarget, color="Target"), size=2) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Powel Release (million acre-feet)") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18))
#theme(text = element_text(size=20), legend.text=element_text(size=16)
#### Powell Release over time - annual
ggplot() +
#Powell release - monthly
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=Total.Release..cfs.*nCFStoAFMon/1e6, color="Monthly"), size=2) +
# Powell release-  annual
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=OneYearRelease, color="1-Year Total"), size=2) +
#  10-year sum
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearRelease, color="10-Year Total"), size=2) +
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearTarget, color="75-Target"), size=2) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Powel Release (million acre-feet)") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18))
#theme(text = element_text(size=20), legend.text=element_text(size=16)
#### 10-Year Difference between Release and 82.5 target
ggplot() +
# Powell release-  annual
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=OneYearRelease, color="1-Year Total"), size=2) +
#  10-year sum
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearDiffRnd, color="10-Year Difference"), size=2) +
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=OneYearRelease, color="Annual release"), size=2) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Powel Release (million acre-feet)") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18))
#theme(text = element_text(size=20), legend.text=element_text(size=16)
ggplot() +
# Powell release-  annual
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=OneYearRelease, color="1-Year Total"), size=2) +
#  10-year sum
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearDiffRnd, color="10-Year Difference"), size=2) +
#  Annual release
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=OneYearRelease, color="Annual release"), size=2) +
#  Customary practice
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearTarget82/10, color="Customary target (8.25 MAF)"), size=2) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Powel Release (million acre-feet)") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18))
#theme(text = element_text(size=20), legend.text=element_text(size=16)
ggplot() +
#Powell release - monthly
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=Total.Release..cfs.*nCFStoAFMon/1e6, color="Monthly"), size=2) +
# Powell release-  annual
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=OneYearRelease, color="1-Year Total"), size=2) +
#  10-year sum
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearRelease, color="10-Year Total"), size=2) +
# 10-year 75 MAF target
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearTarget, color="75 MAF Target"), size=2) +
# 10-year 82.5 MAF target
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearTarget82, color="82.5 MAF Target"), size=2) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Powel Release (million acre-feet)") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18))
#theme(text = element_text(size=20), legend.text=element_text(size=16)
ggplot() +
#Powell release - monthly
#geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=Total.Release..cfs.*nCFStoAFMon/1e6, color="Monthly"), size=2) +
# Powell release-  annual
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=OneYearRelease, color="1-Year Total"), size=2) +
#  10-year sum
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearRelease, color="10-Year Total"), size=2) +
# 10-year 75 MAF target
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearTarget, color="75 MAF Target"), size=2) +
# 10-year 82.5 MAF target
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearTarget82, color="82.5 MAF Target"), size=2) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Powel Release (million acre-feet)") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18))
#theme(text = element_text(size=20), legend.text=element_text(size=16)
ggplot() +
#  10-year sum
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearDiffRnd, color="10-Year Difference"), size=2) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Difference (Powell Release - 82.5 MAF) (million acre-feet)") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18))
#theme(text = element_text(size=20), legend.text=element_text(size=16)
ggplot() +
#  10-year sum
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearDiffRnd, color="10-Year Difference"), size=2) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Powell Release above 10-Year Requirement\n(million acre-feet)") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18))
#theme(text = element_text(size=20), legend.text=element_text(size=16)
sPowellHistoricalFile <- 'PowellDataUSBRMay2020.csv'
# File name to read in Mead end of month reservoir level in feet - cross tabulated by year (1st column) and month (subsequent columns)
#    LAKE MEAD AT HOOVER DAM, END OF MONTH ELEVATION (FEET), Lower COlorado River Operations, U.S. Buruea of Reclamation
#    https://www.usbr.gov/lc/region/g4000/hourly/mead-elv.html
# Read in the historical Powell data
dfPowellHistorical <- read.csv(file=sPowellHistoricalFile,
header=TRUE,
stringsAsFactors=FALSE,
sep=",")
#Interpolate Powell storage from level to check
dtStart <- as.Date("1963-12-22")
dfPowellHist <- dfPowellHistorical[15:692,] #%>% filter(dfPowellHistorical$Date >= dtStart) # I don't like this hard coding but don't know a way around
#Convert date text to date value
dfPowellHist$DateAsValueError <- as.Date(dfPowellHist$Date,"%d-%b-%y")
#Apparently R breaks the century at an odd place
#Coerce the years after 2030 (really 1930) to be in prior century (as.Date conversion error)
dfPowellHist$Year <- as.numeric(format(dfPowellHist$DateAsValueError,"%Y"))
dfPowellHist$DateAsValue <- dfPowellHist$DateAsValueError
dfPowellHist$DateAsValue[dfPowellHist$Year > 2030] <- dfPowellHist$DateAsValue[dfPowellHist$Year > 2030] %m-% months(12*100)
# Convert CFS to Acre-feet per month
nCFStoAFMon <- 60.37
#Annual total release
dfPowellHist$OneYearRelease <- rollapply(dfPowellHist$Total.Release..cfs.*nCFStoAFMon/1e6, 12,sum, fill=NA, align="right")
#10-year total release
dfPowellHist$TenYearRelease <- rollapply(dfPowellHist$Total.Release..cfs.*nCFStoAFMon/1e6, 12*10,sum, fill=NA, align="right")
#75 and 82.5 MAF ten-year targets
dfPowellHist$TenYearTarget <- 75
dfPowellHist$TenYearTarget82 <- 75 + 7.5
# Difference between 10-year and target
dfPowellHist$Diff <- dfPowellHist$TenYearRelease - dfPowellHist$TenYearTarget82
#Filter to get yearly amounts. Filter on October
dfPowellHist$Month <- month(dfPowellHist$DateAsValue)
dfPowellHist$Year <- year(dfPowellHist$DateAsValue)
dfPowellHistAnnual <- dfPowellHist %>% filter(Month==10)
# Add text for the decade
dfPowellHistAnnual$Decade <- paste0(dfPowellHistAnnual$Year - 10 + 1," to ",dfPowellHistAnnual$Year)
dfPowellHistAnnual$TenYearReleaseRnd <- round(dfPowellHistAnnual$TenYearRelease, digits=1)
dfPowellHistAnnual$TenYearDiffRnd <- round(dfPowellHistAnnual$Diff, digits=1)
# Select into two columns and reverse sort
dfPowellByDecade <- dfPowellHistAnnual %>% arrange(Year, decreasing = TRUE) %>% select(Decade, TenYearReleaseRnd,TenYearDiffRnd)
#Export to CSV
write.csv(dfPowellByDecade,"DecadePowellRelease.csv" )
#### Powell Release over time - monthly
ggplot() +
#Powell release - monthly
geom_line(data=dfPowellHist,aes(x=DateAsValue,y=Total.Release..cfs.*nCFStoAFMon/1e6, color="Monthly"), size=2) +
# Powell release-  annual
geom_line(data=dfPowellHist,aes(x=DateAsValue,y=OneYearRelease, color="1-year"), size=2) +
#  10-year sum
geom_line(data=dfPowellHist,aes(x=DateAsValue,y=TenYearRelease, color="10-year"), size=2) +
geom_line(data=dfPowellHist,aes(x=DateAsValue,y=TenYearTarget, color="Target"), size=2) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Powel Release (million acre-feet)") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18))
#theme(text = element_text(size=20), legend.text=element_text(size=16)
#### Powell Release over time - annual
ggplot() +
#Powell release - monthly
#geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=Total.Release..cfs.*nCFStoAFMon/1e6, color="Monthly"), size=2) +
# Powell release-  annual
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=OneYearRelease, color="1-Year Total"), size=2) +
#  10-year sum
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearRelease, color="10-Year Total"), size=2) +
# 10-year 75 MAF target
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearTarget, color="75 MAF Target"), size=2) +
# 10-year 82.5 MAF target
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearTarget82, color="82.5 MAF Target"), size=2) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Powel Release (million acre-feet)") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18))
#theme(text = element_text(size=20), legend.text=element_text(size=16)
#### 10-Year Difference between Release and 82.5 target
ggplot() +
#  10-year sum
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearDiffRnd, color="10-Year Difference"), size=2) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Powell Release above 10-Year Requirement\n(million acre-feet)") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18))
#theme(text = element_text(size=20), legend.text=element_text(size=16)
dtStart <- as.Date("1963-12-22")
dfPowellHist <- dfPowellHistorical[15:692,] #%>% filter(dfPowellHistorical$Date >= dtStart) # I don't like this hard coding but don't know a way around
#Convert date text to date value
dfPowellHist$DateAsValueError <- as.Date(dfPowellHist$Date,"%d-%b-%y")
#Apparently R breaks the century at an odd place
#Coerce the years after 2030 (really 1930) to be in prior century (as.Date conversion error)
dfPowellHist$Year <- as.numeric(format(dfPowellHist$DateAsValueError,"%Y"))
dfPowellHist$DateAsValue <- dfPowellHist$DateAsValueError
dfPowellHist$DateAsValue[dfPowellHist$Year > 2030] <- dfPowellHist$DateAsValue[dfPowellHist$Year > 2030] %m-% months(12*100)
# Convert CFS to Acre-feet per month
nCFStoAFMon <- 60.37
#Annual total release
dfPowellHist$OneYearRelease <- rollapply(dfPowellHist$Total.Release..cfs.*nCFStoAFMon/1e6, 12,sum, fill=NA, align="right")
#10-year total release
dfPowellHist$TenYearRelease <- rollapply(dfPowellHist$Total.Release..cfs.*nCFStoAFMon/1e6, 12*10,sum, fill=NA, align="right")
#75 and 82.5 MAF ten-year targets
dfPowellHist$TenYearTarget <- 75
dfPowellHist$TenYearTarget82 <- 75 + 7.5
# Difference between 10-year and target
dfPowellHist$Diff <- dfPowellHist$TenYearRelease - dfPowellHist$TenYearTarget82
#Filter to get yearly amounts. Filter on October
dfPowellHist$Month <- month(dfPowellHist$DateAsValue)
dfPowellHist$Year <- year(dfPowellHist$DateAsValue)
dfPowellHistAnnual <- dfPowellHist %>% filter(Month==10)
# Add text for the decade
dfPowellHistAnnual$Decade <- paste0(dfPowellHistAnnual$Year - 10 + 1," to ",dfPowellHistAnnual$Year)
dfPowellHistAnnual$TenYearReleaseRnd <- round(dfPowellHistAnnual$TenYearRelease, digits=1)
dfPowellHistAnnual$TenYearDiffRnd <- round(dfPowellHistAnnual$Diff, digits=1)
# Select into two columns and reverse sort
dfPowellByDecade <- dfPowellHistAnnual %>% arrange(Year, decreasing = TRUE) %>% select(Decade, TenYearReleaseRnd,TenYearDiffRnd)
#Export to CSV
write.csv(dfPowellByDecade,"DecadePowellRelease.csv" )
#### Powell Release over time - monthly
ggplot() +
#Powell release - monthly
geom_line(data=dfPowellHist,aes(x=DateAsValue,y=Total.Release..cfs.*nCFStoAFMon/1e6, color="Monthly"), size=2) +
# Powell release-  annual
geom_line(data=dfPowellHist,aes(x=DateAsValue,y=OneYearRelease, color="1-year"), size=2) +
#  10-year sum
geom_line(data=dfPowellHist,aes(x=DateAsValue,y=TenYearRelease, color="10-year"), size=2) +
geom_line(data=dfPowellHist,aes(x=DateAsValue,y=TenYearTarget, color="Target"), size=2) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Powel Release (million acre-feet)") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18))
#theme(text = element_text(size=20), legend.text=element_text(size=16)
#### Powell Release over time - annual
ggplot() +
#Powell release - monthly
#geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=Total.Release..cfs.*nCFStoAFMon/1e6, color="Monthly"), size=2) +
# Powell release-  annual
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=OneYearRelease, color="1-Year Total"), size=2) +
#  10-year sum
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearRelease, color="10-Year Total"), size=2) +
# 10-year 75 MAF target
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearTarget, color="75 MAF Target"), size=2) +
# 10-year 82.3 MAF target. 82.3 = 75 to Lower Basin + 7.25 to Mexico - 0.2 Help from Paria River
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearTarget82, color="82.3 MAF Target"), size=2) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Powel Release (million acre-feet)") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18))
#theme(text = element_text(size=20), legend.text=element_text(size=16)
#### 10-Year Difference between Release and 82.3 target
ggplot() +
#  10-year sum
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearDiffRnd, color="10-Year Difference"), size=2) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Powell Release above 10-Year Requirement\n(million acre-feet)") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18))
#theme(text = element_text(size=20), legend.text=element_text(size=16)
# Powell10Year.r
#
# Plot 10-year running total release from Lake Powell
#
# This is a beginning R-programming effort! There could be lurking bugs or basic coding errors that I am not even aware of.
# Please report bugs/feedback to me (contact info below)
#
# Data from USBR (2020) - https://www.usbr.gov/rsvrWater/HistoricalApp.html
#
# David E. Rosenberg
# June 1, 2020
# Utah State University
# david.rosenberg@usu.edu
rm(list = ls())  #Clear history
# Load required libraies
if (!require(tidyverse)) {
install.packages("tidyverse", repos="http://cran.r-project.org")
library(tidyverse)
}
if (!require(readxl)) {
install.packages("readxl", repos="http://cran.r-project.org")
library(readxl)
}
if (!require(RColorBrewer)) {
install.packages("RColorBrewer",repos="http://cran.r-project.org")
library(RColorBrewer) #
}
if (!require(dplyr)) {
install.packages("dplyr",repos="http://cran.r-project.org")
library(dplyr) #
}
if (!require(expss)) {
install.packages("expss",repos="http://cran.r-project.org")
library(expss) #
}
if (!require(reshape2)) {
install.packages("reshape2", repos="http://cran.r-project.org")
library(reshape2)
}
if (!require(pracma)) {
install.packages("pracma", repos="http://cran.r-project.org")
library(pracma)
}
if (!require(lubridate)) {
install.packages("lubridate", repos="http://cran.r-project.org")
library(lubridate)
}
if (!require(directlabels)) {
install.packages("directlabels", repo="http://cran.r-project.org")
library(directlabels)
}
if (!require(plyr)) {
install.packages("plyr", repo="http://cran.r-project.org")
library(plyr)
}
if (!require(ggrepel)) {
devtools::install_github("slowkow/ggrepel")
library(ggrepel)
}
#For rollapply - running sum
if (!require(zoo)) {
devtools::install_github("zoo")
library(zoo)
}
sPowellHistoricalFile <- 'PowellDataUSBRMay2020.csv'
# File name to read in Mead end of month reservoir level in feet - cross tabulated by year (1st column) and month (subsequent columns)
#    LAKE MEAD AT HOOVER DAM, END OF MONTH ELEVATION (FEET), Lower COlorado River Operations, U.S. Buruea of Reclamation
#    https://www.usbr.gov/lc/region/g4000/hourly/mead-elv.html
# Read in the historical Powell data
dfPowellHistorical <- read.csv(file=sPowellHistoricalFile,
header=TRUE,
stringsAsFactors=FALSE,
sep=",")
#Interpolate Powell storage from level to check
dtStart <- as.Date("1963-12-22")
dfPowellHist <- dfPowellHistorical[15:692,] #%>% filter(dfPowellHistorical$Date >= dtStart) # I don't like this hard coding but don't know a way around
#Convert date text to date value
dfPowellHist$DateAsValueError <- as.Date(dfPowellHist$Date,"%d-%b-%y")
#Apparently R breaks the century at an odd place
#Coerce the years after 2030 (really 1930) to be in prior century (as.Date conversion error)
dfPowellHist$Year <- as.numeric(format(dfPowellHist$DateAsValueError,"%Y"))
dfPowellHist$DateAsValue <- dfPowellHist$DateAsValueError
dfPowellHist$DateAsValue[dfPowellHist$Year > 2030] <- dfPowellHist$DateAsValue[dfPowellHist$Year > 2030] %m-% months(12*100)
# Convert CFS to Acre-feet per month
nCFStoAFMon <- 60.37
#Annual total release
dfPowellHist$OneYearRelease <- rollapply(dfPowellHist$Total.Release..cfs.*nCFStoAFMon/1e6, 12,sum, fill=NA, align="right")
#10-year total release
dfPowellHist$TenYearRelease <- rollapply(dfPowellHist$Total.Release..cfs.*nCFStoAFMon/1e6, 12*10,sum, fill=NA, align="right")
#75 and 82.5 MAF ten-year targets
dfPowellHist$TenYearTarget <- 75
dfPowellHist$TenYearTarget82 <- 75 + 7.5
# Difference between 10-year and target
dfPowellHist$Diff <- dfPowellHist$TenYearRelease - dfPowellHist$TenYearTarget82
#Filter to get yearly amounts. Filter on October
dfPowellHist$Month <- month(dfPowellHist$DateAsValue)
dfPowellHist$Year <- year(dfPowellHist$DateAsValue)
dfPowellHistAnnual <- dfPowellHist %>% filter(Month==10)
# Add text for the decade
dfPowellHistAnnual$Decade <- paste0(dfPowellHistAnnual$Year - 10 + 1," to ",dfPowellHistAnnual$Year)
dfPowellHistAnnual$TenYearReleaseRnd <- round(dfPowellHistAnnual$TenYearRelease, digits=1)
dfPowellHistAnnual$TenYearDiffRnd <- round(dfPowellHistAnnual$Diff, digits=1)
# Select into two columns and reverse sort
dfPowellByDecade <- dfPowellHistAnnual %>% arrange(Year, decreasing = TRUE) %>% select(Decade, TenYearReleaseRnd,TenYearDiffRnd)
#Export to CSV
write.csv(dfPowellByDecade,"DecadePowellRelease.csv" )
#### Powell Release over time - monthly
ggplot() +
#Powell release - monthly
geom_line(data=dfPowellHist,aes(x=DateAsValue,y=Total.Release..cfs.*nCFStoAFMon/1e6, color="Monthly"), size=2) +
# Powell release-  annual
geom_line(data=dfPowellHist,aes(x=DateAsValue,y=OneYearRelease, color="1-year"), size=2) +
#  10-year sum
geom_line(data=dfPowellHist,aes(x=DateAsValue,y=TenYearRelease, color="10-year"), size=2) +
geom_line(data=dfPowellHist,aes(x=DateAsValue,y=TenYearTarget, color="Target"), size=2) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Powel Release (million acre-feet)") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18))
#theme(text = element_text(size=20), legend.text=element_text(size=16)
#### Powell Release over time - annual
ggplot() +
#Powell release - monthly
#geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=Total.Release..cfs.*nCFStoAFMon/1e6, color="Monthly"), size=2) +
# Powell release-  annual
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=OneYearRelease, color="1-Year Total"), size=2) +
#  10-year sum
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearRelease, color="10-Year Total"), size=2) +
# 10-year 75 MAF target
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearTarget, color="75 MAF Target"), size=2) +
# 10-year 82.3 MAF target. 82.3 = 75 to Lower Basin + 7.25 to Mexico - 0.2 Help from Paria River
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearTarget82, color="82.3 MAF Target"), size=2) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Powel Release (million acre-feet)") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18))
#theme(text = element_text(size=20), legend.text=element_text(size=16)
#### 10-Year Difference between Release and 82.3 target
ggplot() +
#  10-year sum
geom_line(data=dfPowellHistAnnual,aes(x=DateAsValue,y=TenYearDiffRnd, color="10-Year Difference"), size=2) +
theme_bw() +
#coord_fixed() +
labs(x="", y="Powell Release above 10-Year Requirement\n(million acre-feet)") +
theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18))
#theme(text = element_text(size=20), legend.text=element_text(size=16)
